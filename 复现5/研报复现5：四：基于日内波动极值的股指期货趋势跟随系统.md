## 研报复现4：四：基于日内波动极值的股指期货趋势跟随系统

### 一、策略概述

#### 1.1 日内波动极值模型

设$c_1,c_2,...,c_n$ 为股指期货日内某一频率下的K线收盘价序列，$h_1,h_2,...,h_n$ 为股指期货日内某一频率下的K线最高价序列，$l_1,l_2,...,l_n$ 为股指期货日内某一频率下的K线最低价序列，$sL$为日内波动极值偏移周期数，定义
$$
\begin{aligned}
&v H_{i}=\max _{1 \leq j \leq \max (i-s L, 1)}\left(h_{j}\right), \quad i=1,2, \cdots, n \\
&v L_{i}=\min _{1 \leq j \leq \max(i-s L, 1)}\left(l_{j}\right), \quad i=1,2, \cdots, n
\end{aligned}
$$
其中$vH_i, vL_i$ 为第i根K线处日内波动极高值和日内波动的极低值。

由于考虑日内波动，为了保证$vH_i, vL_i$ 的稳定性，故截去$i$ 小于某一个阈值的信号计算，即在日内交易中开盘后的某一段时间内不触发信号，当开盘交易数据量达到一定程度后开始进行日内极值波动的趋势跟踪策略。

设$cL$为截断阈值，则定义买卖信号为
$$
S_{i}= \begin{cases}1, & \text { if } \quad c_{i} \geq v H_{i} \text { and } i \geq c L+1 \\ -1, & \text { if } \quad c_{i} \leq v L_{i} \text { and } i \geq c L+1 \\ 0, & \text { else }\end{cases}
$$
其中$S_i$为i时刻的信号，1代表买入，-1代表卖出，0代表无信号。当触发首个信号后，对之进行开仓，引入止损机制——头寸跟踪策略，触发止损后平仓，再根据最新的买卖信号进行开仓。

根据研报取$sL=2,cL=15$。

#### 1.2 头寸跟踪策略

初始止损位：设置为信号发生点所在周期的最高价（空头信号），最低价（多头信号）。

离场价位：动态计算，借鉴SAR系统算法：

$H_i,L_i,i=1,2,3,...,n$ 为$i$ 时刻的最高价与最低价，对于多头来说，$j_0$ 为持有多头的开始时刻，给定$k$ 时刻 $SAR_k$ ，有：
$$
S A R_{k+1}=\min \left(\min _{k-1 \leq j \leq k}\left(L_{j}\right), S A R_{k}+\left(\max _{j_{0} \leq j \leq k}\left(H_{j}\right)-S A R_{k}\right) \times A F\right)
$$
 $AF$ 为加速因子，每当价格创开仓以来新高一次  $AF$ 增加$stepsize$ , $AF$ 上限为 $maxaf$ ， $stepsize$，$maxaf$ 自定义。

逻辑为：以多头信号为例，实质上是将立场家向进场以来创出的新高价逐步靠拢的过程，靠拢的速度取决于创出新高的次数，由加速因子控制，创新高的次数越多表明趋势越强，此时离场价由于加速因子的增大而迅速跟进，这样，当价格向下时，由于离场价与最高价相差不大，会保护既有浮动盈利。

本文计算公式为：

记 $h_{i}, l_{i}$ 为 $i$ 时刻的最高价、最低价, $i=1,2, \cdots, n, j_{0}$ 为开仓时点, 给定 $k$ 时刻 的离场价 $v C_{k}$, 则：
多头头寸: $v C_{k+1}=v C_{k}+\left(\max _{j_{0} \leq j \leq k}\left(h_{j}\right)-v C_{k}\right) \times A F$
空头头寸: $v C_{k+1}=v C_{k}-\left(v C_{k}-\min _{j_{0} \leq j \leq k}\left(L_{j}\right)\right) \times A F$

根据研报，$AF$ 初始值为0，每当市场创出自开仓以来新高或者新低一次，$stepsize$ 增加0.01, $AF$ 上限 $maxaf$ 为0.1。

###### 图1：判断交易流程图

![image-20220512115608344](C:\Users\三三\AppData\Roaming\Typora\typora-user-images\image-20220512115608344.png)

###### 图2：跟踪头寸策略计算流程图（以开多仓为例）

![image-20220512122221373](C:\Users\三三\AppData\Roaming\Typora\typora-user-images\image-20220512122221373.png)

### 二、实证分析

**（1）数据选取**：

本实证选取沪深300股指期货合约加权平均（IF8888）在2010年4月16日到2011年12月09日的5分钟K线为样本集。评价指标考察：累计收益，多仓空仓胜率、持有期、最大回撤、年化收益、年华标准差、夏普比率等。

**（2）交易假设**：

设置单边冲击成本0.4个指数点：

![image-20220511165228032](C:\Users\三三\AppData\Roaming\Typora\typora-user-images\image-20220511165228032.png)

此外单边手续费万分之一，开仓价格为信号发生后第一根K线的开盘价格。

加入止损机制——头寸跟踪策略，触及止损机制时，平仓止损，再根据之后的交易信号值开仓，若当日未发生止损，则收盘15:00强制平仓。

**（3）回测结果：**

```
累计收益       31.87%
多仓次数          403
多仓成功次数        101
多仓胜率       25.06%
多仓平均持有期     10.28
空仓次数          541
空仓成功次数        112
空仓胜率       20.70%
空仓平均持有期      9.50
周期胜率       46.48%
最大回撤       11.45%
年化收益/最大回撤    1.60
年化收益       18.26%
年化标准差      14.68%
年化夏普         1.24
```

###### 图3：指数期货与收益（红线为收益，蓝线为指数期货）

![image-20220512113123336](C:\Users\三三\AppData\Roaming\Typora\typora-user-images\image-20220512113123336.png)

###### 图4：收益

![image-20220512113138180](C:\Users\三三\AppData\Roaming\Typora\typora-user-images\image-20220512113138180.png)

### 三、参数选择

对不同的cL和sL进行收益率计算，其中sL取值2,3, cL取值6-20，则有如下收益率：

###### 表1：不同参数下累计收益率

![image-20220512122747444](C:\Users\三三\AppData\Roaming\Typora\typora-user-images\image-20220512122747444.png)

![image-20220512122813730](C:\Users\三三\AppData\Roaming\Typora\typora-user-images\image-20220512122813730.png)

可见仍有其他参数取值的收益率高于默认的取值。